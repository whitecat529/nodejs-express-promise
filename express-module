var express = module.exports = function () {
    return app;
};

var router = {};
var middlewares = [route];

function route(req, res, next) {
    var u = req.url.toLowerCase();
    var m = req.method.toLowerCase();
    var handler = u + m;

    if (router[handler]) {
        router[handler](req, res);
    } else {
        res.end('sorry, err!');
    }
}

function app(req, res) {
    var index = 0;

    function next() {
        var middleware = middlewares[index++];
        if (middleware) {
            middleware(req, res, next);
        }
    }

    next();
}

app.use = function (func) {
    // 插入到 route 之前
    middlewares.splice(middlewares.length - 1, 0, func);
};

app.route = function (url, method, func) {
    url = url.toLowerCase();
    method = method.toLowerCase();

    router[url + method] = func;
};
